= provide(:title, @apprenticeship.title )
= provide(:googleshim, true)
#apprenticeship_show

  %section.title_section.section
    .container
      %h1= @apprenticeship.title_html
      %p
        - unless current_user.blank?
          - if @apprenticeship.started? && @apprenticeship.user == current_user
            = link_to "Resume", edit_apprenticeship_path(@apprenticeship)
          - elsif @apprenticeship.pending? && @apprenticeship.user == current_user
            = link_to "Delete", @apprenticeship, :method => :delete, :data => { :confirm => 'Are you sure you want to delete this apprenticeship? Deleting cannot be undone.' }
          - elsif @apprenticeship.accepted? && @apprenticeship.user == current_user
            %p
              = link_to "Cancel", cancel_apprenticeships_path(id: @apprenticeship), {method: :post, :confirm => "Are you sure you want to cancel this apprenticeship? It will be closed for sign-up and moved under My Canceled Apprenticeships. You will still be able to edit and resubmit it."}
              |
              = link_to "Edit", edit_apprenticeship_path(@apprenticeship)

  %section#desc_section.section
    .container
      .row-fluid
        .span4
          - if @apprenticeship.accepted?
            - if current_user && current_user.age < @apprenticeship.age_min
              = link_to "Apply!", new_apprenticeship_app_signup_path(@apprenticeship), :class => "btn btn-block disabled"
              %p
                Sorry, it looks like you're younger than the minimum age for this apprenticeship.
              %br/
              %p
                To be notified next time she's teaching: #{link_to "Pre-register with #{@apprenticeship.host_firstname}", new_prereg_path, :class => "btn btn-block btn-small btn-warning"}

            - elsif current_user && current_user.age > @apprenticeship.age_max
              = link_to "Apply!", new_apprenticeship_app_signup_path(@apprenticeship), :class => "btn btn-block disabled"
              %p
                Sorry, it looks like you're older than the maximum age for this apprenticeship.
              %br/
              %p
                To be notified next time she's teaching: #{link_to "Pre-Register with #{@apprenticeship.host_firstname}", new_prereg_path, :class => "btn btn-block btn-small btn-warning"}
              %p
                Wait! I'm a parent using my account to: #{link_to "Sign my Daughter Up", new_apprenticeship_app_signup_path(@apprenticeship), :class => "btn btn-block btn-small btn-success"}

            - elsif current_user && @apprenticeship.already_applied?(current_user)
              = link_to "View your application", apprenticeship_app_signup_path(@apprenticeship, @apprenticeship.get_signup(current_user).id), :class => "btn btn-block"

            - elsif @apprenticeship.datetime_tba == true || @apprenticeship.state == "filled" || @apprenticeship.state == "completed"
              = link_to "I'm interested!", new_prereg_path, :class => "btn btn-block btn-small btn-warning"

            - else
              = link_to "Apply!", new_apprenticeship_app_signup_path(@apprenticeship), :class => "btn btn-block btn-primary"

        .span8
          %dl.dl-horizontal
            %dt Description
            %dd= simple_format(@apprenticeship.description)


            %dt When
            - if @apprenticeship.datetime_tba == "0"
              %dd #{@apprenticeship.begins_at.strftime('%A, %B %d')} to #{@apprenticeship.ends_at.strftime('%A, %B %d')}
            - else
              %dd TBA - Pre-register to be notified when the timeframe is set.

            %dt Where
            %dd #{@apprenticeship.location_private ? @apprenticeship.location_nbrhood + ' neighborhood' : @apprenticeship.location_address} in #{@apprenticeship.location_city}, #{@apprenticeship.location_state}

            %dt Ages
            %dd #{@apprenticeship.age_min} - #{@apprenticeship.age_max}

  %section#tags_section.section
    .container
      .row-fluid
        .span4.well
          %h3 Skills
          %ul.nav.nav-stacked
            -  @apprenticeship.skill_list.each do |skill|
              %li
                %a #{skill}
        .span4.well
          %h3 Tools
          %ul.nav.nav-stacked
            -  @apprenticeship.tool_list.each do |tool|
              %li
                %a #{tool}
        .span4.well
          %h3 Prerequisites
          %ul.nav.nav-stacked
            - if @apprenticeship.requirement_list.present?
              -  @apprenticeship.requirement_list.each do |requirement|
                %li
                  %a #{requirement}
            - else
              %p You're good to go!
              %p (No prerequisites)

  %section#album_section.section.alt
    .container
      .row-fluid
        #current_album
          #album_photos.transitions-enabled.clearfix
            = render 'albums/album_photos'

  %section#host_section.section
    .container
      .row-fluid
        .span2
          #avatar= avatar_for(@apprenticeship.user, tag: 'large')
        .span10
          %dl.dl-horizontal
            %dt Bio
            %dd= @apprenticeship.bio

            %dt Site
            %dd= @apprenticeship.website

            - if @apprenticeship.webshop.present?
              %dt Web Shop
              %dd= @apprenticeship.webshop

            - if @apprenticeship.facebook.present?
              %dt Facebook Page
              %dd= @apprenticeship.facebook

            - if @apprenticeship.twitter.present?
              %dt Twitter
              %dd= @apprenticeship.twitter

  %section#details_section.section.alt
    .map-top-shadow
    #map
    .map-bottom-shadow

  %section#admin_section.section
    .container
      .row-fluid
        - if current_user && current_user.admin? && @apprenticeship.pending?
          %hr
          %h3 Admin Controls
          = form_for(@apprenticeship) do |f|
            = f.submit "Reject Apprenticeship", :name => "reject_button", :class => "btn btn-large btn-danger"
            = f.submit "Approve Apprenticeship", :name => "accept_button", :class => "btn btn-large btn-success"

        - if current_user && current_user.admin? && @apprenticeship.accepted?
          %hr
          %h3 Admin Controls
          = form_for(@apprenticeship) do |f|
            = f.submit "Revoke Apprenticeship", :name => "revoke_button", :class => "btn btn-large btn-danger"